# Week 1

relation sheet
relationship
relation: set of sets

# Week 2 Entity

| ç±»åˆ«     | æœ¯è¯­                                             | å®šä¹‰                                         |
| -------- | ------------------------------------------------ | -------------------------------------------- |
| **å®ä½“** | å¼ºå®ä½“ (strong entity)                           | ç‹¬ç«‹å­˜åœ¨ã€æœ‰è‡ªèº«ä¸»é”®çš„å®ä½“                   |
|          | å¼±å®ä½“ (weak entity)                             | ä¾èµ–å¼ºå®ä½“ä¸»é”®æ‰èƒ½å”¯ä¸€æ ‡è¯†çš„å®ä½“             |
|          | æ­£åˆ™å®ä½“ (regular entity)                        | ä¸å¼ºå®ä½“åŒä¹‰ï¼Œå¼ºè°ƒç‹¬ç«‹å­˜åœ¨                   |
|          | å­˜åœ¨ä¾èµ– (existence-dependent)                   | å®ä½“å­˜åœ¨ä¾èµ–äºå¦ä¸€ä¸ªå®ä½“                     |
|          | å­˜åœ¨ç‹¬ç«‹ (existence-independent)                 | å®ä½“å¯ç‹¬ç«‹å­˜åœ¨ï¼Œä¸ä¾èµ–å…¶ä»–å®ä½“               |
| **å±æ€§** | ç®€å•å±æ€§ (simple attribute)                      | åŸå­ä¸å¯å†åˆ†ï¼Œå¦‚â€œæ€§åˆ«â€                       |
|          | æ´¾ç”Ÿå±æ€§ (derived attribute)                     | å¯ç”±å…¶å®ƒå±æ€§è®¡ç®—ï¼Œå¦‚â€œå¹´é¾„â€                   |
|          | å¤åˆå±æ€§ (composite attribute)                   | ç”±å¤šä¸ªå­å±æ€§ç»„æˆï¼Œå¦‚â€œåœ°å€â€ï¼ã€ˆçœã€å¸‚ã€è¡—é“ã€‰ |
|          | å¤šå€¼å±æ€§ (multivalued attribute)                 | åŒä¸€å®ä½“å¯æœ‰å¤šä¸ªå€¼ï¼Œå¦‚â€œç”µè¯å·ç â€             |
|          | å•å€¼å±æ€§ (single-valued attribute)               | æ¯ä¸ªå®ä½“å®ä¾‹ä»…ä¸€ä¸ªå€¼ï¼Œå¦‚â€œèº«ä»½è¯å·â€           |
|          | å¿…éœ€å±æ€§ (required attribute)                    | ä¸å¯ä¸ºç©ºçš„å±æ€§                               |
|          | å¯é€‰å±æ€§ (optional attribute)                    | å¯å–ç©ºå€¼çš„å±æ€§                               |
|          | åŸŸ (domain)                                      | å±æ€§å–å€¼èŒƒå›´ï¼Œå¦‚æ€§åˆ«åŸŸ={ç”·, å¥³}              |
| **å…³ç³»** | äºŒå…ƒå…³ç³» (binary relationship)                   | ä¸¤ä¸ªå®ä½“é—´å…³è”ï¼Œå¦‚â€œå‘˜å·¥-æ‰€å±-éƒ¨é—¨â€           |
|          | ä¸‰å…ƒå…³ç³» (ternary relationship)                  | ä¸‰ä¸ªå®ä½“åŒæ—¶å‚ä¸çš„å…³è”                       |
|          | ä¸€å…ƒå…³ç³»/é€’å½’å…³ç³» (unary/recursive relationship) | åŒä¸€å®ä½“çš„è‡ªå¼•ç”¨å…³ç³»                         |
|          | å¼ºï¼ˆæ ‡è¯†ï¼‰å…³ç³» (identifying)                     | ç”¨äºæ ‡è¯†å¼±å®ä½“ä¸»é”®çš„å…³ç³»                     |
|          | å¼±ï¼ˆéæ ‡è¯†ï¼‰å…³ç³» (non-identifying)               | æ™®é€šä¸»å¤–é”®å…³ç³»ï¼Œä¸å‚ä¸å¼±å®ä½“æ ‡è¯†             |
|          | è¿é€šæ€§/åŸºæ•° (connectivity/cardinality)           | æè¿°å…³è”çš„ 1:1ã€1:Nã€M:N ç±»å‹                |
|          | å‚ä¸åº¦ (participation)                           | å®ä½“åœ¨å…³ç³»ä¸­æ˜¯å¦å¿…éœ€ï¼šå¼ºåˆ¶/å¯é€‰              |
| **å»ºæ¨¡** | æ ‡è¯†ç¬¦ (identifiers)                             | å®ä½“ä¸»é”®ï¼Œåˆ†ç®€å•æ ‡è¯†ç¬¦ã€å¤åˆæ ‡è¯†ç¬¦           |
|          | å…³ç³»æ¨¡å¼ (relational schema)                     | ER æ¨¡å‹æ˜ å°„åˆ°å…³ç³»æ¨¡å‹åçš„è¡¨ç»“æ„å®šä¹‰          |
|          | è¿­ä»£è¿‡ç¨‹ (iterative process)                     | ER å»ºæ¨¡çš„åå¤å®Œå–„æµç¨‹                        |

# Week 6 Considering Personal Data in Database Design | Creating & Altering the Database

## Considering Personal Data in Database Design

## Creating & Altering the Database

### Components of SQL language

- DDL(Data Definition Language)
- DML(Data Manipulation Language)
- DCL(Data Conrtol Language)

### Oracle Data Type

### DDL

#### Common ORACLE Data Types
| Code | Data Type                                                      | å‚æ•°ä¿¡æ¯è¯´æ˜                                                |
| ---- | -------------------------------------------------------------- | ----------------------------------------------------------- |
| 1    | VARCHAR2(size [BYTEï½œCHAR])                                    | `size`ï¼šæœ€å¤§é•¿åº¦ï¼›BYTE/CHARï¼šæŒ‰å­—èŠ‚æˆ–å­—ç¬¦è®¡æ•°               |
| 1    | NVARCHAR2(size)                                                | `size`ï¼šæœ€å¤§å­—ç¬¦æ•°ï¼ˆä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œæ”¯æŒUnicodeï¼‰             |
| 2    | NUMBER([precision [, scale]])                                  | `precision`ï¼šæ€»ä½æ•°ï¼›`scale`ï¼šå°æ•°ä½æ•°                      |
| 8    | LONG                                                           | æœ€å¤šå­˜å‚¨ 2GB å­—ç¬¦æ•°æ®ï¼ˆå·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨ï¼‰                 |
| 12   | DATE                                                           | å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ï¼ŒåŸºäº **Gregorian** å†æ³•         |
| 21   | BINARY_FLOAT                                                   | å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆ32ä½ï¼‰                                        |
| 22   | BINARY_DOUBLE                                                  | åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆ64ä½ï¼‰                                        |
| 23   | RAW(size)                                                      | `size`ï¼šæœ€å¤§å­—èŠ‚æ•°ï¼ˆå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼‰                        |
| 24   | LONG RAW                                                       | æœ€å¤šå­˜å‚¨ 2GB äºŒè¿›åˆ¶æ•°æ®ï¼ˆå·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨ï¼‰               |
| 69   | ROWID                                                          | å­˜å‚¨è¡Œçš„å”¯ä¸€ç‰©ç†åœ°å€                                        |
| 96   | CHAR [(size [BYTEï½œCHAR])]                                     | `size`ï¼šå›ºå®šé•¿åº¦å­—ç¬¦ä¸²ï¼›BYTE/CHARï¼šæŒ‰å­—èŠ‚æˆ–å­—ç¬¦è®¡æ•°         |
| 96   | NCHAR[(size)]                                                  | `size`ï¼šå›ºå®šé•¿åº¦ Unicode å­—ç¬¦ä¸²                             |
| 112  | CLOB                                                           | å­˜å‚¨å¤§å¯¹è±¡ï¼Œæœ€å¤§ 4GB å­—ç¬¦æ•°æ®                               |
| 112  | NCLOB                                                          | å­˜å‚¨å¤§å¯¹è±¡ï¼Œæœ€å¤§ 4GB Unicode å­—ç¬¦æ•°æ®                       |
| 113  | BLOB                                                           | å­˜å‚¨äºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼Œæœ€å¤§ 4GB                                  |
| 114  | BFILE                                                          | å­˜å‚¨å¤–éƒ¨æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆåªè¯»ï¼Œæ•°æ®åº“å¤–éƒ¨ï¼‰                |
| 180  | TIMESTAMP [(fractional_seconds)]                               | `fractional_seconds`ï¼šå°æ•°ç§’ä½æ•°ï¼ˆ0â€“9ï¼‰                     |
| 181  | TIMESTAMP [(fractional_seconds)] WITH TIME ZONE                | å¸¦æ—¶åŒºçš„æ—¶é—´æˆ³                                              |
| 182  | INTERVAL YEAR [(year_precision)] TO MONTH                      | `year_precision`ï¼šå¹´ä½æ•°ï¼ˆé»˜è®¤2ï¼Œæœ€å¤§9ï¼‰                    |
| 183  | INTERVAL DAY [(day_precision)] TO SECOND[(fractional_seconds)] | `day_precision`ï¼šå¤©ä½æ•°ï¼›`fractional_seconds`ï¼šç§’çš„å°æ•°ä½æ•° |
| 208  | UROWID [(size)]                                                | `size`ï¼šæœ€å¤§å­˜å‚¨é•¿åº¦ï¼Œç”¨äºå­˜å‚¨ç´¢å¼•ç»„ç»‡è¡¨è¡Œåœ°å€              |
| 231  | TIMESTAMP [(fractional_seconds)] WITH LOCAL TIMEZONE           | å¸¦æœ¬åœ°æ—¶åŒºçš„æ—¶é—´æˆ³                                          |

#### Create Syntax
```sql
CREATE TABLE table_name (
  column_name data_type [DEFAULT expr] [constraint],
  ...
  [table_constraints]
);

```

#### Column VS Table Level Constraints
| çº¦æŸç±»å‹        | åˆ—çº§å¯å®šä¹‰ | è¡¨çº§å¯å®šä¹‰ | è¯´æ˜                                                 |
| --------------- | ---------- | ---------- | ---------------------------------------------------- |
| **NOT NULL**    | âœ…          | âŒ          | **åªèƒ½åˆ—çº§**ï¼Œå› ä¸ºå®ƒåªé’ˆå¯¹å•ä¸€åˆ—ã€‚                   |
| **PRIMARY KEY** | âœ…          | âœ…          | è¡¨çº§å¯ä»¥å®šä¹‰ **å¤åˆä¸»é”®**ï¼ˆå¤šåˆ—ï¼‰ï¼Œåˆ—çº§åªèƒ½å•åˆ—ã€‚    |
| **UNIQUE**      | âœ…          | âœ…          | è¡¨çº§å¯ä»¥å®šä¹‰ **å¤šåˆ—å”¯ä¸€æ€§**ï¼Œåˆ—çº§åªèƒ½å•åˆ—å”¯ä¸€ã€‚      |
| **FOREIGN KEY** | âœ…          | âœ…          | åˆ—çº§ï¼šå•åˆ—å¤–é”®ï¼›è¡¨çº§ï¼šå¯ä»¥å®šä¹‰å¤åˆå¤–é”®ï¼ˆæ¶‰åŠå¤šåˆ—ï¼‰ã€‚ |
| **CHECK**       | âœ…          | âœ…          | è¡¨çº§ï¼šå¯ä»¥è·¨å¤šåˆ—æ£€æŸ¥ï¼›åˆ—çº§ï¼šä»…é’ˆå¯¹è¯¥åˆ—ã€‚             |

**All constraints other than the not null constraints must have a name.**

#### Alter Syntax

- use alter add constraint
    ```sql
    -- 1) ä¸»é”®ï¼ˆå¯å¤šåˆ—ï¼‰
    ALTER TABLE emp
    ADD CONSTRAINT pk_emp PRIMARY KEY (emp_id)
    USING INDEX;              -- å¯é€‰ï¼šç´¢å¼•é€‰é¡¹/è¡¨ç©ºé—´ç­‰

    -- 2) å”¯ä¸€çº¦æŸï¼ˆå¯å¤šåˆ—ï¼‰
    ALTER TABLE emp
    ADD CONSTRAINT uq_emp_name UNIQUE (emp_name);

    -- 3) å¤–é”®ï¼ˆæ”¯æŒçº§è”/å¯å»¶è¿Ÿæ£€æŸ¥ï¼‰
    ALTER TABLE emp
    ADD CONSTRAINT fk_emp_dept
    FOREIGN KEY (dept_no)
    REFERENCES department(dept_no)
    ON DELETE SET NULL        -- æˆ– ON DELETE CASCADE
    DEFERRABLE INITIALLY DEFERRED;  -- å¯é€‰ï¼šäº‹åŠ¡æäº¤æ—¶å†æ£€æŸ¥

    -- 4) æ£€æŸ¥çº¦æŸï¼ˆå¯è·¨åˆ—ï¼‰
    ALTER TABLE emp
    ADD CONSTRAINT ck_salary CHECK (salary > 0);

    -- 5) NOT NULLï¼ˆåªèƒ½èµ° MODIFY è¯­æ³•ï¼Œè§ä¸‹èŠ‚ï¼‰

    -- çº¦æŸçŠ¶æ€ç®¡ç†
    -- å¯ç”¨/ç¦ç”¨
    ALTER TABLE emp ENABLE  CONSTRAINT fk_emp_dept;
    ALTER TABLE emp DISABLE CONSTRAINT fk_emp_dept;

    -- æ˜¯å¦ç«‹å³æ ¡éªŒå†å²æ•°æ®
    ALTER TABLE emp ENABLE  VALIDATE   CONSTRAINT fk_emp_dept;  -- ç«‹å³æ£€æŸ¥ç°æœ‰æ•°æ®
    ALTER TABLE emp ENABLE  NOVALIDATE CONSTRAINT fk_emp_dept;  -- ä»…å¯¹æ–°æ•°æ®ç”Ÿæ•ˆ
    ```
- use alter modify attributes
    ```sql
    -- 1) æ”¹æ•°æ®ç±»å‹/é•¿åº¦/ç²¾åº¦
    ALTER TABLE emp MODIFY (emp_name VARCHAR2(200 CHAR));
    ALTER TABLE emp MODIFY (salary   NUMBER(10,2));

    -- 2) è®¾ç½®/ç§»é™¤é»˜è®¤å€¼
    ALTER TABLE emp MODIFY (salary DEFAULT 0);
    ALTER TABLE emp MODIFY (salary DEFAULT NULL);

    -- 3) è®¾ç½® NOT NULLï¼ˆå¯å‘½åçº¦æŸï¼‰
    ALTER TABLE emp MODIFY (emp_name CONSTRAINT nn_emp_name NOT NULL);

    -- 4) å…è®¸ NULL
    ALTER TABLE emp MODIFY (emp_name NULL);
    ```
- use alter for mulitple change
    ```sql
    ALTER TABLE employees
      ADD CONSTRAINT pk_emp PRIMARY KEY (emp_id)
      ADD CONSTRAINT ck_salary CHECK (salary > 0)
      MODIFY (emp_name VARCHAR2(100) NOT NULL)
      MODIFY (salary DEFAULT 0);
    ```

---

Oracle ALTER å¯¹å·²æœ‰æ•°æ®çš„å½±å“

åœ¨ **Oracle** é‡Œï¼Œ`ALTER TABLE` ä¿®æ”¹åˆ—å®šä¹‰æˆ–å¢åŠ çº¦æŸæ—¶ï¼Œæ˜¯å¦ç«‹å³ä½œç”¨äºå·²æœ‰æ•°æ®ï¼Œå–å†³äºæ“ä½œç±»å‹ï¼š


1. `MODIFY` ä¿®æ”¹åˆ—å®šä¹‰

* **åŠ é•¿åˆ—é•¿åº¦**

  * ç«‹å³ç”Ÿæ•ˆï¼Œä¸å½±å“å·²æœ‰æ•°æ®ã€‚

  ```sql
  ALTER TABLE emp MODIFY (ename VARCHAR2(200));
  ```

* **ç¼©çŸ­åˆ—é•¿åº¦ / æ”¹ç²¾åº¦**

  * Oracle ä¼šç«‹åˆ»æ£€æŸ¥å·²æœ‰æ•°æ®æ˜¯å¦èƒ½å®¹çº³ã€‚
  * å¦‚æœæœ‰æ•°æ®è¶…å‡ºèŒƒå›´ â†’ æŠ¥é”™ï¼ŒDDL ä¸ä¼šæˆåŠŸã€‚
  * éœ€è¦æ‰‹åŠ¨æ¸…ç†/è½¬æ¢æ•°æ®åå†æ‰§è¡Œã€‚

* **DEFAULT å€¼**

  * å¯¹å·²æœ‰è¡Œ **ä¸æ”¹å˜**ï¼Œåªå¯¹ **ä¹‹åæ’å…¥/æ›´æ–°æ—¶ç¼ºçœå€¼** ç”Ÿæ•ˆã€‚

* **NOT NULL**

  * Oracle ä¼šç«‹åˆ»æ£€æŸ¥å·²æœ‰æ•°æ®æ˜¯å¦å­˜åœ¨ `NULL`ï¼Œå¦‚æœæœ‰ â†’ æŠ¥é”™ã€‚

---

2. `ADD CONSTRAINT`

* **PRIMARY KEY / UNIQUE / CHECK**

  * é»˜è®¤ `ENABLE VALIDATE` â†’ Oracle ä¼šç«‹åˆ»æ£€æŸ¥å…¨è¡¨æ•°æ®æ˜¯å¦ç¬¦åˆã€‚
  * å¦‚æœæ•°æ®ä¸ç¬¦åˆ â†’ æŠ¥é”™ï¼ŒDDL å¤±è´¥ã€‚
  * å¯ä»¥ç”¨ `ENABLE NOVALIDATE` è·³è¿‡å·²æœ‰æ•°æ®æ£€æŸ¥ï¼Œä»…å¯¹æ–°æ•°æ®ç”Ÿæ•ˆã€‚

  ```sql
  ALTER TABLE emp ADD CONSTRAINT ck_salary CHECK (salary > 0) ENABLE NOVALIDATE;
  ```

* **FOREIGN KEY**

  * é»˜è®¤åŒæ ·ä¼šæ£€æŸ¥å·²æœ‰æ•°æ®ï¼›
  * å¯ç”¨ `ENABLE NOVALIDATE` è·³è¿‡æ£€æŸ¥ï¼Œä»…å¯¹æ–°æ•°æ®ç”Ÿæ•ˆã€‚

---

- æ€»ç»“

* **å¤§éƒ¨åˆ† ALTER** â†’ é»˜è®¤ç«‹å³ä½œç”¨å¹¶æ ¡éªŒç°æœ‰æ•°æ®ã€‚
* **DEFAULT** â†’ ä»…å½±å“æ–°æ’å…¥è¡Œï¼Œä¸ä¼šä¿®æ”¹å·²æœ‰æ•°æ®ã€‚
* **çº¦æŸ** â†’ é»˜è®¤æ£€æŸ¥å…¨è¡¨æ•°æ®ï¼Œå¯ç”¨ `ENABLE NOVALIDATE` åªå¯¹æ–°æ•°æ®ç”Ÿæ•ˆã€‚

#### Referential Integrity
å½“ **çˆ¶è¡¨çš„ä¸»é”®è®°å½•è¢«åˆ é™¤**æ—¶ï¼Œå­è¡¨çš„å¤–é”®å¼•ç”¨å¯èƒ½ä¼šæœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚Oracle æ”¯æŒä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š

---

1. RESTRICT ï¼ˆOracle é»˜è®¤ï¼šNO ACTIONï¼‰

* **å«ä¹‰**ï¼šå¦‚æœæŸä¸ªä¸»é”®åœ¨å­è¡¨ä¸­è¿˜æœ‰å¤–é”®å¼•ç”¨ï¼Œåˆ™ **ä¸å…è®¸åˆ é™¤** è¯¥ä¸»é”®è¡Œã€‚
* **ä¾‹å­**ï¼š

  * `DEPARTMENT.dept_no = 10`
  * `EMPLOYEE` è¡¨é‡Œè¿˜æœ‰å¤šè¡Œå‘˜å·¥çš„ `dept_no=10`
  * åˆ é™¤ `DEPARTMENT` è¡¨çš„ `dept_no=10` â†’ **æŠ¥é”™ï¼Œæ‹’ç»åˆ é™¤**ã€‚

---

2. CASCADE ï¼ˆçº§è”åˆ é™¤ï¼ŒOracle è¯­æ³•ï¼š`ON DELETE CASCADE`ï¼‰

* **å«ä¹‰**ï¼šåˆ é™¤çˆ¶è¡¨ï¼ˆä¸»é”®è¡¨ï¼‰çš„è¡Œæ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å­è¡¨ä¸­å¯¹åº”çš„å¤–é”®è¡Œã€‚
* **ä¾‹å­**ï¼š

  * åˆ é™¤ `DEPARTMENT.dept_no=10` â†’ è‡ªåŠ¨æŠŠ `EMPLOYEE` è¡¨ä¸­æ‰€æœ‰ `dept_no=10` çš„è¡Œä¸€å¹¶åˆ é™¤ã€‚

---

3. NULLIFY ï¼ˆç½®ç©ºï¼ŒOracle è¯­æ³•ï¼š`ON DELETE SET NULL`ï¼‰

* **å«ä¹‰**ï¼šåˆ é™¤çˆ¶è¡¨çš„ä¸»é”®è¡Œæ—¶ï¼Œå­è¡¨ä¸­å¯¹åº”çš„å¤–é”®å­—æ®µä¼š **æ›´æ–°ä¸º NULL**ã€‚
* **ä¾‹å­**ï¼š

  * åˆ é™¤ `DEPARTMENT.dept_no=10` â†’ `EMPLOYEE` è¡¨ä¸­æ‰€æœ‰ `dept_no=10` çš„è¡Œä¼šå˜æˆ `dept_no=NULL`ã€‚

#### Referential Integrity ä¸­çš„åˆ é™¤ç­–ç•¥
| ç­–ç•¥                   | ä½¿ç”¨åœºæ™¯                                              | ç¤ºä¾‹                                                                                            | ä¼˜ç‚¹                               |
| ---------------------- | ----------------------------------------------------- | ----------------------------------------------------------------------------------------------- | ---------------------------------- |
| **ON DELETE CASCADE**  | å­è¡¨è®°å½• **å®Œå…¨ä¾èµ–çˆ¶è¡¨**ï¼Œçˆ¶è¡¨ä¸å­˜åœ¨æ—¶å­è¡¨ä¹Ÿåº”è¢«åˆ é™¤ | - è®¢å•ä¸»è¡¨ï¼ˆordersï¼‰ â†” è®¢å•æ˜ç»†è¡¨ï¼ˆorder_itemsï¼‰<br>- å­¦ç”Ÿè¡¨ï¼ˆstudentsï¼‰ â†” æˆç»©è¡¨ï¼ˆscoresï¼‰     | ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¸ä¼šç•™ä¸‹â€œå­¤å„¿è®°å½•â€ |
| **ON DELETE SET NULL** | å­è¡¨è®°å½• **å¯ç‹¬ç«‹å­˜åœ¨**ï¼Œä½†å¤–é”®å…³ç³»å¤±æ•ˆæ—¶éœ€è¦è§£é™¤å…³è” | - å‘˜å·¥è¡¨ï¼ˆemployeesï¼‰ çš„ `manager_id` â†” ç»ç†è¡¨<br>- å®¢æˆ·è¡¨ï¼ˆcustomersï¼‰ çš„æ¨èäººå­—æ®µ â†” æ¨èäººè¡¨ | ä¿ç•™å­è¡¨æ•°æ®ï¼Œä»…è§£é™¤å¤–é”®ä¾èµ–       |


#### Drop syntax
```sql
DROP TABLE table_name [CASCADE CONSTRAINTS] [PURGE];
-- CASCADE CONSTRAINTSï¼šåˆ é™¤è¯¥è¡¨çš„åŒæ—¶ï¼Œè‡ªåŠ¨åˆ é™¤ä¾èµ–å®ƒçš„å¤–é”®çº¦æŸã€‚
-- PURGEï¼šè·³è¿‡å›æ”¶ç«™ï¼Œå½»åº•åˆ é™¤è¡¨ï¼Œæ— æ³•é—ªå›æ¢å¤ã€‚
DROP INDEX index_name;
DROP VIEW view_name;
DROP USER user_name [CASCADE];
-- CASCADEï¼šåˆ é™¤ç”¨æˆ·çš„åŒæ—¶ï¼Œè¿åŒè¯¥ç”¨æˆ·ä¸‹çš„æ‰€æœ‰å¯¹è±¡ä¸€èµ·åˆ é™¤ã€‚
```
# Week 7 DML and Transaction Management

## DML

### Insert

#### Syntax
```sql
-- insert single row
INSERT INTO table_name (column_list)
VALUES( value_list);

INSERT INTO table_name
VALUES (value_list);

-- insert multiple rows
INSERT INTO table_name (column_list)
VALUES 
   ( value_list_1),
   ( value_list_2),
   ( value_list_3);

COMMIT/ROLLBACK
```

If you exclude one or more columns from the Oracle `INSERT` statement, then you must specify the column list because Oracle needs it to match with values in the value list.

The column that you omit in the `INSERT` statement will use the default value if available or `NULL` if the column accepts NULL.

#### Inserting DATES into a table
```sql
INSERT INTO t_orders (id, order_dt)
VALUES (1, TO_DATE('2025-09-30 14:35:00', 'YYYY-MM-DD HH24:MI:SS'));
COMMIT/ROLLBACK
```

#### Using a SEQUENCE
```sql
CREATE SEQUENCE schema_name.sequence_name
[INCREMENT BY interval]
[START WITH first_number]
[MAXVALUE max_value | NOMAXVALUE]
[MINVALUE min_value | NOMINVALUE]
[CYCLE | NOCYCLE]
[CACHE cache_size | NOCACHE]
[ORDER | NOORDER];

sequence_name.nextval
sequence_name.currval
```

### Update
```sql
UPDATE
    table_name
SET
    column1 = value1,
    column2 = value2,
    column3 = value3,
    ...
WHERE
    condition;

-- subquery
UPDATE target_table
SET column1 = (SELECT value_column
               FROM source_table
               WHERE source_table.id = target_table.id)
WHERE EXISTS (SELECT value_column
              FROM source_table
              WHERE source_table.id = target_table.id);
```

### LOWER() and UPPER()
Since we cannot "know" the case of our data, SQL has two functions UPPER
and LOWER used to modify case:
```sql
SELECT * FROM table_name WHERE LOWER(column) = value;
SELECT * FROM table_name WHERE UPPER(column) = value;
```

### Delete
```sql
DELETE
FROM
    table_name
WHERE
    condition;

-- Deleting all rows from a table
DELETE FROM table_name;
```

## Transaction Management

### Transaction Properties
ğŸ“Œ Transaction Properties (äº‹åŠ¡ç‰¹æ€§)

åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡å¿…é¡»å…·å¤‡ä»¥ä¸‹å››ä¸ªå±æ€§ï¼ˆACIDï¼‰ï¼š

1. Atomicityï¼ˆåŸå­æ€§ï¼‰

æ‰€æœ‰æ•°æ®åº“æ“ä½œï¼ˆSQLè¯·æ±‚ï¼‰å¿…é¡» å…¨éƒ¨å®Œæˆæˆ–å…¨éƒ¨ä¸åšã€‚

å¦‚æœäº‹åŠ¡ä¸­çš„ä»»ä½•ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œåˆ™ä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»å›æ»šï¼ˆæ’¤é”€ï¼‰ã€‚

2. Consistencyï¼ˆä¸€è‡´æ€§ï¼‰

äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚

ä¿è¯äº‹åŠ¡å‰åæ•°æ®çš„å®Œæ•´æ€§çº¦æŸä¸è¢«ç ´åã€‚

3. Isolationï¼ˆéš”ç¦»æ€§ï¼‰

äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸åº”å—åˆ°å…¶ä»–å¹¶å‘äº‹åŠ¡çš„å¹²æ‰°ã€‚

æŸä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œæ—¶æ‰€ä½¿ç”¨çš„æ•°æ®åœ¨å…¶å®Œæˆå‰ä¸åº”è¢«å…¶ä»–äº‹åŠ¡è®¿é—®ã€‚

4. Durabilityï¼ˆæŒä¹…æ€§ï¼‰

ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œæ‰€åšçš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚

å³ä½¿ç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œå·²æäº¤çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

### Transaction Management

- Follows the ACID properties
- Transaction boundaries
    - Start
        - first SQL statement is executed (eg. Oracle)
        - Some systems have a BEGIN WORK type command
    - End
        - COMMIT or ROLLBACK
- Concurrency Management
- Restart and Recovery

### Concurrency Management

- Locking mechanism
    - Shared lock
    - Exclusive lock

### Deadlock

- Dealing with deadlock
    - Deadlock prevention
    - Deadlock avoidance
    - Deadlock detection and recovery

### Database Recovery

- Transaction Log
    - Record for beginning of transaction
    - Type of operation being performed (update, delete, insert)
    - Names of objects affected by the transaction (the name of the table)
    - â€œBeforeâ€ and â€œafterâ€ values for updated fields
    - Pointers to previous and next transaction log entries for the same transaction
    - The ending (COMMIT) of the transaction
- Checkpoint
    - Accepting new transactions is temporarily halted, and current transactions are suspended.
    - Results of committed transactions are made permanent (force-written to the disk).
    - A checkpoint record is written in the log.
    - Execution of transactions is resumed.

- Software Crash Recovery
    - Write Through
        1. æ„å»º REDO å’Œ UNDO åˆ—è¡¨

            - æ ¹æ®æ—¥å¿—ï¼Œä»**æœ€è¿‘çš„æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰**å¼€å§‹å‘å‰è¯»å–ï¼Œæ„å»ºä¸¤ä¸ªåˆ—è¡¨ï¼š
                - **REDO list**ï¼šåŒ…å«æ‰€æœ‰ **å·²æäº¤äº‹åŠ¡** çš„ Transaction IDã€‚
                - **UNDO list**ï¼šåŒ…å«æ‰€æœ‰ **æœªå®Œæˆï¼ˆæœªæäº¤æˆ–å·²å›æ»šï¼‰äº‹åŠ¡** çš„ Transaction IDã€‚

        2. UNDO æœªå®Œæˆäº‹åŠ¡ï¼ˆä»æœ€è¿‘å¼€å§‹ï¼‰

            - å¯¹ `UNDO list` ä¸­çš„äº‹åŠ¡æŒ‰**é€†åºï¼ˆä»æ–°åˆ°æ—§ï¼‰**å¤„ç†ï¼›
            - ä½¿ç”¨ **before imageï¼ˆå˜æ›´å‰æ•°æ®ï¼‰** è¿›è¡Œ **ROLLBACK**ï¼›
            - ç›®çš„æ˜¯æ’¤é”€æœªæäº¤äº‹åŠ¡å¯¹æ•°æ®åº“çš„å½±å“ã€‚

        3. REDO å·²æäº¤äº‹åŠ¡ï¼ˆä»æœ€æ—©å¼€å§‹ï¼‰

            - å¯¹ `REDO list` ä¸­çš„äº‹åŠ¡æŒ‰**é¡ºåºï¼ˆä»æ—§åˆ°æ–°ï¼‰**å¤„ç†ï¼›
            - ä½¿ç”¨ **after imageï¼ˆå˜æ›´åæ•°æ®ï¼‰** è¿›è¡Œ **ROLLFORWARD**ï¼›
            - ç›®çš„æ˜¯é‡åšå·²æäº¤äº‹åŠ¡çš„æ“ä½œï¼Œç¡®ä¿æŒä¹…åŒ–å®Œæˆã€‚

    - Deferred Write
        1. æ•°æ®åº“åªåœ¨äº‹åŠ¡æäº¤ï¼ˆCOMMITï¼‰ä¹‹åæ‰å†™å…¥ç£ç›˜
            - æ‰€æœ‰æ›´æ”¹é¦–å…ˆä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆå¦‚ redo log bufferï¼‰ï¼›
            - åªæœ‰åœ¨äº‹åŠ¡çœŸæ­£æäº¤ä¹‹åï¼Œæ‰å°†æ›´æ”¹æ•°æ®å†™å…¥æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶ï¼›
            - åœ¨å´©æºƒå‰æœªæäº¤çš„äº‹åŠ¡æ›´æ”¹ **æ ¹æœ¬ä¸ä¼šå†™å…¥ç£ç›˜**ã€‚

        2. åªéœ€ **Redoï¼ˆé‡åšï¼‰å·²æäº¤äº‹åŠ¡**
            - å´©æºƒæ¢å¤æ—¶åªéœ€è¦å°†å·²æäº¤äº‹åŠ¡çš„æ›´æ”¹é‡æ–°åº”ç”¨ï¼ˆroll forwardï¼‰ï¼›
            - **æ— éœ€å›æ»šæœªæäº¤äº‹åŠ¡**ï¼Œå› ä¸ºå®ƒä»¬æ ¹æœ¬æœªå†™å…¥ç£ç›˜ï¼ˆä¸å­˜åœ¨â€œè„å†™â€ï¼‰ï¼›
            - ç›¸æ¯” Write Through ç­–ç•¥ï¼Œæ­¤ç­–ç•¥çš„æ¢å¤æ›´ç®€å•å¿«é€Ÿã€‚





